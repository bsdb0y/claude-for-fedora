Name:           claude-desktop
Version:        @VERSION@
Release:        1%{?dist}
Summary:        Claude Desktop for Linux
License:        Proprietary
URL:            https://www.anthropic.com
BuildArch:      @ARCHITECTURE@
Requires:       nodejs >= 16.0.0, npm

%description
Claude Desktop for Linux - community build from Windows installer.
Not an official Anthropic package.

%install
mkdir -p %{buildroot}/usr/lib64/%{name}
mkdir -p %{buildroot}/usr/bin
mkdir -p %{buildroot}/usr/share/applications
mkdir -p %{buildroot}/usr/share/icons

cp -r @INSTALL_DIR@/lib/%{name}/* %{buildroot}/usr/lib64/%{name}/
cp @INSTALL_DIR@/bin/* %{buildroot}/usr/bin/
cp @INSTALL_DIR@/share/applications/* %{buildroot}/usr/share/applications/
cp -r @INSTALL_DIR@/share/icons/* %{buildroot}/usr/share/icons/

%files
%{_bindir}/claude-desktop
%{_libdir}/%{name}
%{_datadir}/applications/claude-desktop.desktop
%{_datadir}/icons/hicolor/*/apps/claude-desktop.png

%post
gtk-update-icon-cache -f -t %{_datadir}/icons/hicolor 2>/dev/null || :
update-desktop-database %{_datadir}/applications 2>/dev/null || :

SANDBOX_PATH="/usr/lib64/claude-desktop/app.asar.unpacked/node_modules/electron/dist/chrome-sandbox"
if [ -f "$SANDBOX_PATH" ]; then
    chown root:root "$SANDBOX_PATH" 2>/dev/null || :
    chmod 4755 "$SANDBOX_PATH" 2>/dev/null || :
fi

%postun
if [ $1 -eq 0 ]; then
    gtk-update-icon-cache -f -t %{_datadir}/icons/hicolor 2>/dev/null || :
    update-desktop-database %{_datadir}/applications 2>/dev/null || :
fi
